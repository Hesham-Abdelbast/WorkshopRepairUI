<div class="cnv-backdrop">
  <div class="cnv-modal report-modal">
      <button class="cnv-close" (click)="doClose()">✕</button>
      
      <h2>MR - 001</h2>

      <div class="report-form-grid">
      
      <!-- <label>System ID <span class="required">*</span>
          <input type="text" [(ngModel)]="form.systemId"
           name="systemId" required #systemId="ngModel"/>
      </label> -->
      <label>Project
        <select name="projectId" [(ngModel)]="form.projectId" (change)="onProjectChange()">
          <option [value]="''">Select Project</option>
          <option *ngFor="let p of projects" [value]="p.id">{{p.name}}</option>
        </select>
      </label>


      <label>Unit <span class="required">*</span>
        <select [(ngModel)]="form.systemId" name="systemId" [ngClass]="{'input-error': submitted && !form.systemId}">
          <option [value]="''">Select Unit</option>
          <option *ngFor="let u of units" [value]="u.id">{{u.model}} ({{u.serial}})</option>
        </select>
      </label>

      <label>Report ID <span class="required">*</span>
          <input type="text" [(ngModel)]="form.reportId" name="reportId"
             [ngClass]="{'input-error': submitted && !form.reportId}"/>
      </label>

      <label>Maintenance Visits <span class="required">*</span>
          <input type="text" [(ngModel)]="form.maintenanceVisits" name="maintenanceVisits"
             [ngClass]="{'input-error': submitted && !form.maintenanceVisits}"/>
      </label>

      <label>Date 
          <input type="date" [(ngModel)]="form.date" name="date" (click)="forceDatePicker($event)"/>
      </label>

      <!-- <label>Photos
          <input type="file" multiple (change)="onPhotosSelected($event)" />
      </label> -->

      <!-- <label>Photos
      <div class="file-upload-container">
      <button class="file-upload-button" (click)="openFilePicker()">اختر ملف</button>
      <span *ngIf="selectedFile" class="file-name">{{ selectedFile.name }}</span>
      <span *ngIf="errorMessage" class="error-message">{{ errorMessage }}</span>
      </div>
      </label> -->

      <!-- ✅ الزر الجديد لرفع الصور -->
      <label>Photos
        <div class="custom-file-upload" (click)="openFilePicker()">
          <i class="pin-icon">
              <img src="/assets/images/imgIcon.png" alt="">
          </i>
          <span class="upload-text">Upload File</span>
        </div>
        <div class="selected-files" *ngIf="form.photos.length">
        <div class="selected-thumb" *ngFor="let p of form.photos; let i = index">
          <img [src]="p" alt="photo" (click)="openUrl(p)"/>
          <button type="button" class="remove-photo" (click)="removePhoto(i)">×</button>
        </div>
      </div>
      </label>
      <div class="selected-files" *ngIf="form.files.length">
        <div class="selected-thumb" *ngFor="let f of form.files; let i = index">
          <button type="button" (click)="openUrl(f.url)">{{ f.name }}</button>
          <button type="button" class="remove-photo" (click)="removeFile(i)">×</button>
        </div>
      </div>

      <label>Team Assigned <span class="required">*</span>
          <select [(ngModel)]="form.teamAssigned" name="teamAssigned"
             [ngClass]="{'input-error': submitted && !form.teamAssigned}">
          <option *ngFor="let t of technicians" [value]="t">{{t.name}}</option>
          </select>
      </label>

      <label>Assigned Technician
          <select [(ngModel)]="form.assignedTechnician" name="assignedTechnician" (change)="onTechnicianChange()">
          <option *ngFor="let t of technicians" [value]="t.id">{{t.name}}</option>
          </select>
      </label>

      <!-- <label>Visit Type
          <span class="badge scheduled">{{form.visitType || 'Scheduled'}}</span>
      </label>

      <label>Status
          <span class="badge maintenance">{{form.status || 'Under Maintenance'}}</span>
      </label>
      </div> -->

      <!-- ✅ رجعناهم جوه نفس الـ grid -->
        <label>Visit Type
          <select [(ngModel)]="form.visitType" name="visitType">
          <option *ngFor="let t of VisitType" [value]="t">{{t}}</option>
          </select>
      </label>

        <label>Status <span class="required">*</span>
          <select [(ngModel)]="form.status" name="status"   
           [ngClass]="{'input-error': submitted && !form.status}">
          <option *ngFor="let t of Status" [value]="t">{{t}}</option>
          </select>
      </label>
      </div>
      
      <label class="full-width">Comments
      <textarea [(ngModel)]="form.comments" name="comments" rows="3"></textarea>
      </label>

      <div class="cnv-actions report-actions">
      <button type="button" class="cancel-button" (click)="doClose()">Cancel</button>
      <button type="button" class="save-button-large yellow-bg" (click)="doSave()">Save</button>
      </div>
  </div>
</div>
